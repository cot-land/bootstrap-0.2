// Minimal parser test
import "ast.cot"
import "parser.cot"
import "types.cot"

// Global test pool
var g_nodes: [100]Node;
var g_children: [500]i64;
var g_pool: NodePool;

// Global type registry
var g_types: [50]Type;
var g_type_params: [50]i64;
var g_type_fields: [50]FieldInfo;
var g_type_registry: TypeRegistry;

fn init_test_pool() *NodePool {
    g_pool.nodes = &g_nodes[0];
    g_pool.count = 0;
    g_pool.children = &g_children[0];
    g_pool.children_count = 0;
    // Initialize type registry
    g_type_registry.types = &g_types[0];
    g_type_registry.params = &g_type_params[0];
    g_type_registry.fields = &g_type_fields[0];
    TypeRegistry_init(&g_type_registry);
    return &g_pool;
}

fn main() i64 {
    let pool: *NodePool = init_test_pool();
    var p: Parser = Parser_init("42", pool, &g_type_registry);

    let expr: i64 = Parser_parseExpr(&p);

    let n: *Node = node_get(pool, expr);
    if n.kind != NodeKind.IntLit { return 1; }
    if n.field0 != 42 { return 2; }

    println("Parser test passed!");
    return 0;
}
