// Test: Optional Type Basic Syntax
// Feature: ?T type for nullable values
//
// This test verifies:
// 1. Optional pointer type declaration
// 2. Assigning null to optional
// 3. Assigning non-null to optional
// 4. Null comparison

struct Item {
    key: i64,
    value: i64,
}

fn test_optional_ptr_null() i64 {
    // Optional pointer can be null
    let ptr: ?*Item = null;
    if ptr == null {
        return 1;
    }
    return 0;
}

fn test_optional_ptr_some() i64 {
    var item: Item = undefined;
    item.key = 42;
    item.value = 100;

    // Optional pointer can hold a real pointer
    let ptr: ?*Item = &item;
    if ptr != null {
        return 1;
    }
    return 0;
}

fn test_optional_ptr_reassign() i64 {
    var item: Item = undefined;
    item.key = 99;

    // Start with null
    var ptr: ?*Item = null;
    if ptr != null { return 0; }  // Should be null

    // Assign real value
    ptr = &item;
    if ptr == null { return 0; }  // Should not be null

    return 1;
}

fn test_optional_i64() i64 {
    // Optional integer (uses null as sentinel)
    let maybe: ?i64 = null;
    if maybe == null {
        return 1;
    }
    return 0;
}

fn main() i64 {
    var passed: i64 = 0;

    if test_optional_ptr_null() == 1 { passed = passed + 1; }
    if test_optional_ptr_some() == 1 { passed = passed + 1; }
    if test_optional_ptr_reassign() == 1 { passed = passed + 1; }
    if test_optional_i64() == 1 { passed = passed + 1; }

    // Return 0 if all 4 tests pass
    if passed == 4 {
        return 0;
    }
    return 1;
}
